<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HORCRUX Command Center</title>

<!-- Orbitron Font -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<!-- Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
    margin:0;
    font-family:'Orbitron',sans-serif;
    background:linear-gradient(135deg,#0a0a0a,#1a1a1a);
    color:white;
}

header{
    text-align:center;
    padding:60px 20px;
}

.logo-container{
    position:relative;
    display:inline-block;
}

.logo-container img{
    width:200px;
    height:200px;
    border-radius:50%;
    border:none;
    box-shadow: 0 0 30px #ff0033, 0 0 50px rgba(255,0,0,0.5);
}

.logo-container::before{
    content:'';
    position:absolute;
    top:-20px;
    left:-20px;
    width:240px;
    height:240px;
    border-radius:50%;
    background: radial-gradient(circle, rgba(255,0,0,0.4), transparent 70%);
    filter: blur(25px);
    animation: flame 2s infinite alternate;
    z-index:1;
}

@keyframes flame{
    0%{transform: scale(1) rotate(0deg);}
    25%{transform: scale(1.05) rotate(5deg);}
    50%{transform: scale(1.1) rotate(-5deg);}
    75%{transform: scale(1.05) rotate(5deg);}
    100%{transform: scale(1) rotate(0deg);}
}

.logo-container .sub{
    color:#ff4444;
    margin-top:15px;
    font-size:22px;
}

/* Dashboard */
.dashboard{
    display:flex;
    justify-content:center;
    gap:25px;
    padding:50px;
}

.card{
    background:#111;
    border:2px solid #ff0033;
    padding:40px 20px;
    text-align:center;
    border-radius:12px;
    transition:0.3s;
    cursor:pointer;
}

.card:hover{
    transform:scale(1.05);
    box-shadow:0 0 20px #ff0033;
}

.card h2{
    margin:15px 0;
    font-size:20px;
}

.card span{
    font-size:40px;
}

/* Content */
.category-list, .enemy-list, .enemy-detail{
    margin:20px auto;
    max-width:800px;
    text-align:center;
}

.enemy-list button, #addFormBtn{
    display:block;
    margin:10px auto;
    padding:10px 20px;
    background:#ff0033;
    border:none;
    border-radius:8px;
    cursor:pointer;
    transition:0.3s;
    color:white;
}

.enemy-list button:hover, #addFormBtn:hover{
    background:#ff5555;
}

.slider{
    display:flex;
    overflow-x:auto;
    gap:10px;
    scroll-behavior:smooth;
    justify-content:center;
}

.slider img{
    height:150px;
    border-radius:8px;
}

/* Form */
#addForm{
    display:none;
    background:#111;
    border:2px solid #ff0033;
    border-radius:12px;
    padding:20px;
    margin:20px auto;
    max-width:600px;
    text-align:center;
}

#addForm input, #addForm textarea, #addForm select{
    width:100%;
    margin-bottom:10px;
    padding:8px;
    border-radius:6px;
    border:none;
}

#addForm button[type="submit"]{
    background:#ff0033;
    color:white;
    padding:10px 20px;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
#addForm button[type="submit"]:hover{
    background:#ff5555;
}

footer{
    text-align:center;
    padding:30px;
    color:#555;
}
</style>
</head>
<body>

<header>
    <div class="logo-container">
        <img src="HORCRUX-LOGO.png" alt="HORCRUX Logo">
        <div class="sub">COMMAND CENTER</div>
    </div>
</header>

<!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å: 4 ‡∏õ‡∏∏‡πà‡∏° category -->
<div class="dashboard">
    <div class="card" onclick="showCategory('castle')">
        <span>üè∞</span>
        <h2>‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡∏ä‡∏¥‡∏á‡∏õ‡∏£‡∏≤‡∏™‡∏≤‡∏ó</h2>
    </div>
    <div class="card" onclick="showCategory('guild')">
        <span>‚öî</span>
        <h2>‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡∏Å‡∏¥‡∏•‡∏î‡πå</h2>
    </div>
    <div class="card" onclick="showCategory('traveler')">
        <span>üåå</span>
        <h2>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏∏‡∏ï‡∏¥</h2>
    </div>
    <div class="card" onclick="showCategory('strategy')">
        <span>üß†</span>
        <h2>‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ï‡∏µ‡∏î‡πà‡∏≤‡∏ô / ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</h2>
    </div>
</div>

<!-- ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡πâ‡∏≤‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π -->
<div class="enemy-list" id="enemyList"></div>

<!-- ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ö‡πâ‡∏≤‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π -->
<div class="enemy-detail" id="enemyDetail"></div>

<!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡πâ‡∏≤‡∏ô -->
<button id="addFormBtn" onclick="toggleAddForm()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π</button>

<!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡πâ‡∏≤‡∏ô -->
<form id="addForm">
    <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π</h3>
    <input type="text" id="enemy_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡πâ‡∏≤‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π" required>
    <input type="file" id="enemy_file" multiple accept="image/*">
    <input type="file" id="team_file" multiple accept="image/*">
    <textarea id="strategy" rows="3" placeholder="‡∏ß‡∏¥‡∏ò‡∏µ‡∏ö‡∏∏‡∏Å‡∏ö‡πâ‡∏≤‡∏ô" required></textarea>
    <select id="category">
        <option value="castle">‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡∏ä‡∏¥‡∏á‡∏õ‡∏£‡∏≤‡∏™‡∏≤‡∏ó</option>
        <option value="guild">‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡∏Å‡∏¥‡∏•‡∏î‡πå</option>
        <option value="traveler">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏∏‡∏ï‡∏¥</option>
        <option value="strategy">‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ï‡∏µ‡∏î‡πà‡∏≤‡∏ô / ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
    </select>
    <button type="button" onclick="saveData()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ö‡πâ‡∏≤‡∏ô</button>
</form>

<footer>HORCRUX ‚Ä¢ Dominate The War</footer>

<script>
const supabaseClient = supabase.createClient(
    "https://cwkmfpxmzqlbrioununv.supabase.co",
    "sb_publishable_bmbm3cCoH3OoVvMfbQis8A_AgJgpCMX"
);

let allData = [];

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
async function loadData(){
    const { data, error } = await supabaseClient
        .from("enemy_base")
        .select("*")
        .order("created_at",{ ascending:false });

    if(error){ console.error(error); return; }
    allData = data;
}
loadData();

// ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡πâ‡∏≤‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π
function showCategory(cat){
    document.getElementById("enemyList").innerHTML = "";
    document.getElementById("enemyDetail").innerHTML = "";
    const filtered = allData.filter(e => e.category === cat);
    filtered.forEach(row => {
        const btn = document.createElement("button");
        btn.textContent = row.enemy_name;
        btn.onclick = ()=>showDetail(row);
        document.getElementById("enemyList").appendChild(btn);
    });
}

// ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ö‡πâ‡∏≤‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π
function showDetail(row){
    const detailDiv = document.getElementById("enemyDetail");
    detailDiv.innerHTML = `
        <h3>${row.enemy_name}</h3>
        <b>‡∏ù‡∏±‡πà‡∏á‡∏®‡∏±‡∏ï‡∏£‡∏π:</b>
        <div class="slider">
            ${(row.enemy_imgs||[]).map(i=>`<img src="${i}">`).join("")}
        </div>
        <b>‡∏ó‡∏µ‡∏°‡∏ö‡∏∏‡∏Å:</b>
        <div class="slider">
            ${(row.team_imgs||[]).map(i=>`<img src="${i}">`).join("")}
        </div>
        <b>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ö‡∏∏‡∏Å:</b>
        <p>${row.strategy}</p>
    `;
}

// ‡∏ü‡∏≠‡∏£‡πå‡∏° toggle
function toggleAddForm(){
    const f = document.getElementById("addForm");
    f.style.display = f.style.display === "block" ? "none" : "block";
}

// upload ‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ
async function uploadMultipleImages(files){
    if(!files || files.length===0) return [];
    const urls = [];
    for(const file of files){
        const ext = file.name.split(".").pop();
        const name = `${Date.now()}_${Math.random().toString(36).substr(2)}.${ext}`;
        const path = `horcrux/${name}`;
        const { error } = await supabaseClient.storage.from("images").upload(path,file,{cacheControl:"3600",upsert:true});
        if(error){console.error(error); continue;}
        const { data:urlData } = supabaseClient.storage.from("images").getPublicUrl(path);
        urls.push(urlData.publicUrl);
    }
    return urls;
}

// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ö‡πâ‡∏≤‡∏ô
async function saveData(){
    const enemy_name = document.getElementById("enemy_name").value;
    const enemyFiles = document.getElementById("enemy_file").files;
    const teamFiles = document.getElementById("team_file").files;
    const strategy = document.getElementById("strategy").value;
    const category = document.getElementById("category").value;

    if(!enemy_name || enemyFiles.length===0 || teamFiles.length===0 || !strategy){
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á!");
        return;
    }

    const enemyUrls = await uploadMultipleImages(enemyFiles);
    const teamUrls = await uploadMultipleImages(teamFiles);

    const { error } = await supabaseClient.from("enemy_base").insert([{
        enemy_name,
        enemy_imgs: enemyUrls,
        team_imgs: teamUrls,
        strategy,
        category
    }]);

    if(error){ alert(error.message); return; }

    alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
    document.getElementById("addForm").reset();
    loadData();
}
</script>
</body>
</html>
