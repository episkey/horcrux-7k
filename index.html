<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HORCRUX Command Center</title>

<!-- Orbitron Font -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<!-- Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
    margin:0;
    font-family:'Orbitron',sans-serif;
    background:linear-gradient(135deg,#0a0a0a,#1a1a1a);
    color:white;
}
header{
    text-align:center;
    padding:60px 20px;
}
.logo-container{
    position:relative;
    display:inline-block;
}
.logo-container img{
    width:200px;
    height:200px;
    border-radius:50%;
    border:none;
    box-shadow: 0 0 30px #ff0033, 0 0 50px rgba(255,0,0,0.5);
    position: relative;
    z-index: 2;
}
.logo-container::before{
    content:''; position:absolute; top:-20px; left:-20px;
    width:240px; height:240px; border-radius:50%;
    background: radial-gradient(circle, rgba(255,0,0,0.4), transparent 70%);
    filter: blur(25px);
    animation: flame 2s infinite alternate; z-index:1;
}
@keyframes flame{
    0%{transform: scale(1) rotate(0deg);}
    25%{transform: scale(1.05) rotate(5deg);}
    50%{transform: scale(1.1) rotate(-5deg);}
    75%{transform: scale(1.05) rotate(5deg);}
    100%{transform: scale(1) rotate(0deg);}
}
.logo-container .sub{color:#ff4444; margin-top:15px; font-size:22px;}
.dashboard{
    display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
    gap:25px; padding:50px;
}
.card{
    background:#111; border:2px solid #ff0033;
    padding:40px 20px; text-align:center;
    border-radius:12px; transition:0.3s; cursor:pointer;
}
.card:hover{
    transform:scale(1.05);
    box-shadow:0 0 20px #ff0033;
}
.card h2{ margin:15px 0; font-size:20px; }
.card span{ font-size:40px; }
.house-list{ margin:30px 50px; }
.enemy-btn{
    width:100%; margin:5px 0; padding:10px;
    border-radius:6px; border:none; cursor:pointer;
    background:#222; color:white; text-align:left; font-size:16px;
}
.enemy-btn:hover{ background:#333; }
.enemy-detail{ margin-bottom:15px; padding:10px; border:1px solid #ff0033; border-radius:8px; }
.slider{ display:flex; overflow-x:auto; gap:10px; scroll-behavior:smooth; }
.slider img{ height:150px; border-radius:8px; cursor:pointer; }
#imgModal{ display:none; position:fixed; inset:0; background:#000000cc; justify-content:center; align-items:center; z-index:999; }
#imgModal img{ max-width:90%; max-height:90%; }
footer{ text-align:center; padding:30px; color:#555; }
#add-form-container{ background:#111; border:2px solid #ff0033; padding:20px; border-radius:12px; max-width:600px; margin:20px auto; display:none; text-align:center; }
#add-form input,#add-form textarea,#add-form select{ width:100%; margin-bottom:10px; padding:8px; border-radius:6px; border:none; }
#add-form button{ background:#ff0033; color:white; padding:10px 20px; border:none; border-radius:6px; cursor:pointer; }
#add-form button:hover{ background:#ff5555; }
.upload-btn{ display:block; background:#ff0033; padding:10px; border-radius:8px; cursor:pointer; margin-bottom:10px; text-align:center; }
.upload-btn:hover{ background:#ff4444; }
.add-btn{ background:#ff0033; color:white; padding:12px 25px; border:none; border-radius:8px; cursor:pointer; }
.add-btn:hover{ background:#ff5555; }
</style>
</head>
<body>

<header>
    <div class="logo-container">
        <img src="HORCRUX-LOGO.png" alt="HORCRUX Logo">
        <div class="sub">COMMAND CENTER</div>
    </div>
</header>

<section class="dashboard">
    <div class="card" onclick="filterCategory('castle')">
        <span>üè∞</span>
        <h2>‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡∏ä‡∏¥‡∏á‡∏õ‡∏£‡∏≤‡∏™‡∏≤‡∏ó</h2>
    </div>
    <div class="card" onclick="filterCategory('guild')">
        <span>‚öî</span>
        <h2>‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡∏Å‡∏¥‡∏•‡∏î‡πå</h2>
    </div>
    <div class="card" onclick="filterCategory('traveler')">
        <span>üåå</span>
        <h2>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏∏‡∏ï‡∏¥</h2>
    </div>
    <div class="card" onclick="filterCategory('strategy')">
        <span>üß†</span>
        <h2>‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ï‡∏µ‡∏î‡πà‡∏≤‡∏ô / ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</h2>
    </div>
</section>

<section style="text-align:center; margin:20px;">
    <button onclick="showAddForm()" class="add-btn">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π</button>
</section>

<!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡πâ‡∏≤‡∏ô -->
<div id="add-form-container">
    <form id="add-form">
        <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π</h3>
        <label class="upload-btn">üì∑ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏ù‡∏±‡πà‡∏á‡∏®‡∏±‡∏ï‡∏£‡∏π
            <input type="file" id="enemy_file" multiple accept="image/*">
        </label>
        <label class="upload-btn">‚öî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡∏°‡∏ö‡∏∏‡∏Å
            <input type="file" id="team_file" multiple accept="image/*">
        </label>
        <textarea id="strategy" rows="3" placeholder="‡∏ß‡∏¥‡∏ò‡∏µ‡∏ö‡∏∏‡∏Å‡∏ö‡πâ‡∏≤‡∏ô" required></textarea>
        <select id="category">
            <option value="castle">‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡∏ä‡∏¥‡∏á‡∏õ‡∏£‡∏≤‡∏™‡∏≤‡∏ó</option>
            <option value="guild">‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡∏Å‡∏¥‡∏•‡∏î‡πå</option>
            <option value="traveler">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏∏‡∏ï‡∏¥</option>
            <option value="strategy">‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ï‡∏µ‡∏î‡πà‡∏≤‡∏ô / ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
        </select>
        <button type="button" onclick="saveData()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ö‡πâ‡∏≤‡∏ô</button>
    </form>
</div>

<!-- ‡πÅ‡∏™‡∏î‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π -->
<div class="house-list" id="list"></div>

<div id="imgModal" onclick="closeModal()">
    <img id="modalImg">
</div>

<footer>HORCRUX ‚Ä¢ Dominate The War</footer>

<script>
// Supabase
const supabaseClient = supabase.createClient(
  "https://cwkmfpxmzqlbrioununv.supabase.co",
  "sb_publishable_bmbm3cCoH3OoVvMfbQis8A_AgJgpCMX"
);

let allData = [];

async function loadData(){
    const { data, error } = await supabaseClient
        .from("enemy_base")
        .select("*")
        .order("created_at",{ ascending:false });
    if(error){ console.error(error); return; }
    allData = data;
}

// ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà ‚Üí ‡πÅ‡∏Ñ‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡πâ‡∏≤‡∏ô
function filterCategory(cat){
    const filtered = allData.filter(d=>d.category===cat);
    displayMaster(filtered);
}

function displayMaster(data){
    const list = document.getElementById("list");
    list.innerHTML = "";
    data.forEach((row, idx)=>{
        const btn = document.createElement("button");
        btn.textContent = row.strategy.substring(0,20)+"‚Ä¶";
        btn.className = "enemy-btn";
        btn.onclick = ()=>toggleDetail(idx);
        const detail = document.createElement("div");
        detail.className = "enemy-detail";
        detail.style.display="none";
        detail.innerHTML = `
            <h4>‡∏ù‡∏±‡πà‡∏á‡∏®‡∏±‡∏ï‡∏£‡∏π:</h4>
            <div class="slider">${(row.enemy_imgs||[]).map(i=>`<img src="${i}" onclick="openModal('${i}')">`).join('')}</div>
            <h4>‡∏ó‡∏µ‡∏°‡∏ö‡∏∏‡∏Å:</h4>
            <div class="slider">${(row.team_imgs||[]).map(i=>`<img src="${i}" onclick="openModal('${i}')">`).join('')}</div>
            <h4>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ö‡∏∏‡∏Å:</h4>
            <p>${row.strategy}</p>
        `;
        list.appendChild(btn);
        list.appendChild(detail);
    });
}

function toggleDetail(idx){
    const details = document.getElementsByClassName("enemy-detail");
    for(let i=0;i<details.length;i++){
        details[i].style.display = i===idx?(details[i].style.display==='none'?'block':'none'):'none';
    }
}

// ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡πâ‡∏≤‡∏ô
function showAddForm(){
    const container = document.getElementById("add-form-container");
    container.style.display = container.style.display==='none'?'block':'none';
}

async function uploadMultipleImages(files){
    if(!files || files.length===0) return [];
    const urls=[];
    for(const f of files){
        const ext = f.name.split('.').pop();
        const fname = `${Date.now()}_${Math.random().toString(36).substring(2)}.${ext}`;
        const path = `horcrux/${fname}`;
        const { error } = await supabaseClient.storage.from('images').upload(path,f,{cacheControl:'3600', upsert:true});
        if(error){ console.error(error); alert(error.message); continue; }
        const { data:urlData } = supabaseClient.storage.from('images').getPublicUrl(path);
        urls.push(urlData.publicUrl);
    }
    return urls;
}

async function saveData(){
    const enemyFiles = document.getElementById("enemy_file").files;
    const teamFiles = document.getElementById("team_file").files;
    const strategy = document.getElementById("strategy").value;
    const category = document.getElementById("category").value;

    if(enemyFiles.length===0 || teamFiles.length===0 || !strategy){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á"); return; }

    const enemyUrls = await uploadMultipleImages(enemyFiles);
    const teamUrls = await uploadMultipleImages(teamFiles);

    const { error } = await supabaseClient.from("enemy_base").insert([{
        enemy_imgs:enemyUrls,
        team_imgs:teamUrls,
        strategy,
        category
    }]);

    if(error){ alert(error.message); } else { alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"); document.getElementById("add-form").reset(); loadData(); }
}

// modal
function openModal(src){ const m=document.getElementById("imgModal"); m.style.display="flex"; document.getElementById("modalImg").src=src;}
function closeModal(){ document.getElementById("imgModal").style.display="none"; }

loadData();
</script>
</body>
</html>
