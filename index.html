<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HORCRUX Command Center</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
    margin:0;
    font-family:'Orbitron',sans-serif;
    background:linear-gradient(135deg,#0a0a0a,#1a1a1a);
    color:white;
}

header{
    text-align:center;
    padding:60px 20px;
}

.logo-container{
    position:relative;
    display:inline-block;
}

.logo-container img{
    width:200px;
    height:200px;
    border-radius:50%;
    border:none;
    box-shadow: 0 0 30px #ff0033, 0 0 50px rgba(255,0,0,0.5);
    position: relative;
    z-index: 2;
}

.logo-container::before{
    content:'';
    position:absolute;
    top:-20px;
    left:-20px;
    width:240px;
    height:240px;
    border-radius:50%;
    background: radial-gradient(circle, rgba(255,0,0,0.4), transparent 70%);
    filter: blur(25px);
    animation: flame 2s infinite alternate;
    z-index:1;
}

@keyframes flame{
    0%{transform: scale(1) rotate(0deg);}
    25%{transform: scale(1.05) rotate(5deg);}
    50%{transform: scale(1.1) rotate(-5deg);}
    75%{transform: scale(1.05) rotate(5deg);}
    100%{transform: scale(1) rotate(0deg);}
}

.logo-container .sub{
    color:#ff4444;
    margin-top:15px;
    font-size:22px;
}

/* Dashboard */
.dashboard{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:20px;
    padding:40px;
}

.card{
    background:#111;
    border:2px solid #ff0033;
    padding:20px;
    text-align:center;
    border-radius:12px;
    transition:0.3s;
    cursor:pointer;
}

.card:hover{
    transform:scale(1.05);
    box-shadow:0 0 20px #ff0033;
}

.card h2{
    margin:10px 0;
    font-size:18px;
}

.card span{
    font-size:30px;
}

button{
    background:#ff0033;
    color:white;
    padding:8px 16px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    margin:5px 0;
}

button:hover{
    background:#ff5555;
}

.house-list{
    margin:20px 50px;
}

.slider {
    display:flex;
    overflow-x:auto;
    gap:10px;
    scroll-behavior:smooth;
}

.slider img{
    height:120px;
    border-radius:8px;
    cursor:pointer;
}

#imgModal{
    display:none;
    position:fixed;
    inset:0;
    background:#000000cc;
    justify-content:center;
    align-items:center;
    z-index:999;
}
#imgModal img{
    max-width:90%;
    max-height:90%;
    border-radius:8px;
}

#add-form{
    background:#111;
    border:2px solid #ff0033;
    border-radius:12px;
    padding:20px;
    margin:20px auto;
    max-width:600px;
    text-align:center;
}

#add-form input, #add-form textarea, #add-form select{
    width:100%;
    margin-bottom:10px;
    padding:8px;
    border-radius:6px;
    border:none;
}

.upload-btn{
    display:block;
    background:#ff0033;
    padding:10px;
    border-radius:8px;
    cursor:pointer;
    margin-bottom:10px;
    transition:0.3s;
    text-align:center;
}

.upload-btn:hover{
    background:#ff4444;
}

</style>
</head>
<body>

<header>
    <div class="logo-container">
        <img src="HORCRUX-LOGO.png" alt="HORCRUX Logo">
        <div class="sub">COMMAND CENTER</div>
    </div>
</header>

<section class="dashboard">
    <div class="card" onclick="showCategory('castle')">
        <span>üè∞</span>
        <h2>‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡∏ä‡∏¥‡∏á‡∏õ‡∏£‡∏≤‡∏™‡∏≤‡∏ó</h2>
    </div>
    <div class="card" onclick="showCategory('guild')">
        <span>‚öî</span>
        <h2>‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡∏Å‡∏¥‡∏•‡∏î‡πå</h2>
    </div>
    <div class="card" onclick="showCategory('traveler')">
        <span>üåå</span>
        <h2>‡∏ô‡∏±‡∏Å‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏∏‡∏ï‡∏¥</h2>
    </div>
    <div class="card" onclick="showCategory('strategy')">
        <span>üß†</span>
        <h2>‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ï‡∏µ‡∏î‡πà‡∏≤‡∏ô / ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</h2>
    </div>
</section>

<!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π -->
<section id="add-form" style="display:none;">
    <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π</h3>
    <label class="upload-btn">
        üì∑ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏ù‡∏±‡πà‡∏á‡∏®‡∏±‡∏ï‡∏£‡∏π
        <input type="file" id="enemy_file" multiple accept="image/*">
    </label>
    <div id="enemy_preview"></div>

    <label class="upload-btn">
        ‚öî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡∏°‡∏ö‡∏∏‡∏Å
        <input type="file" id="team_file" multiple accept="image/*">
    </label>
    <div id="team_preview"></div>

    <textarea id="strategy" rows="3" placeholder="‡∏ä‡∏∑‡πà‡∏≠/‡∏ß‡∏¥‡∏ò‡∏µ‡∏ö‡∏∏‡∏Å‡∏ö‡πâ‡∏≤‡∏ô" required></textarea>
    <select id="category">
        <option value="castle">‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡∏ä‡∏¥‡∏á‡∏õ‡∏£‡∏≤‡∏™‡∏≤‡∏ó</option>
        <option value="guild">‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡∏Å‡∏¥‡∏•‡∏î‡πå</option>
        <option value="traveler">‡∏ô‡∏±‡∏Å‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏∏‡∏ï‡∏¥</option>
        <option value="strategy">‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ï‡∏µ‡∏î‡πà‡∏≤‡∏ô / ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
    </select>

    <button type="button" onclick="saveData()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ö‡πâ‡∏≤‡∏ô</button>
</section>

<section id="list"></section>

<section id="detail"></section>

<!-- Modal Zoom -->
<div id="imgModal" onclick="this.style.display='none'">
    <img id="modalImg">
</div>

<script>
const supabaseClient = supabase.createClient(
  "https://cwkmfpxmzqlbrioununv.supabase.co",
  "sb_publishable_bmbm3cCoH3OoVvMfbQis8A_AgJgpCMX"
);

let allData = [];
let currentCategory = null;
let currentDetailId = null;

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
async function loadData(){
    const { data, error } = await supabaseClient
        .from("enemy_base")
        .select("*")
        .order("created_at",{ ascending: false });
    if(error){ console.error(error); return; }
    allData = data;
}
loadData();

// ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
function showCategory(cat){
    const listEl = document.getElementById("list");
    listEl.innerHTML = "";

    // ‡∏ñ‡πâ‡∏≤‡∏Å‡∏î‡∏ã‡πâ‡∏≥ category ‡πÄ‡∏î‡∏¥‡∏° ‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î
    if(currentCategory === cat){
        currentCategory = null;
        document.getElementById("detail").innerHTML = "";
        return;
    }

    currentCategory = cat;

    const filtered = allData.filter(d=>d.category===cat);

    filtered.forEach((row,i)=>{
        const btn = document.createElement("button");
        btn.textContent = row.strategy.substring(0,30) || `‡∏®‡∏±‡∏ï‡∏£‡∏π ${i+1}`;
        btn.onclick = ()=>showDetail(row);
        listEl.appendChild(btn);
    });

    document.getElementById("detail").innerHTML = "";
}

// ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
function showDetail(row){
    const detailEl = document.getElementById("detail");

    // ‡∏ñ‡πâ‡∏≤‡∏Å‡∏î‡∏ã‡πâ‡∏≥‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏¥‡∏° ‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î
    if(currentDetailId === row.id){
        currentDetailId = null;
        detailEl.innerHTML = "";
        return;
    }
    currentDetailId = row.id;

    let html = `<h3>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏®‡∏±‡∏ï‡∏£‡∏π</h3>`;
    html += `<p><b>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ö‡∏∏‡∏Å:</b> ${row.strategy}</p>`;

    html += `<b>‡∏ù‡∏±‡πà‡∏á‡∏®‡∏±‡∏ï‡∏£‡∏π:</b>`;
    html += `<div class="slider">`;
    (row.enemy_imgs || []).forEach(i=>{
        html += `<img src="${i}" onclick="openModal('${i}')">`;
    });
    html += `</div>`;

    html += `<b>‡∏ó‡∏µ‡∏°‡∏ö‡∏∏‡∏Å:</b>`;
    html += `<div class="slider">`;
    (row.team_imgs || []).forEach(i=>{
        html += `<img src="${i}" onclick="openModal('${i}')">`;
    });
    html += `</div>`;

    detailEl.innerHTML = html;
}

// Modal Zoom
function openModal(src){
    const modal = document.getElementById("imgModal");
    const modalImg = document.getElementById("modalImg");
    modalImg.src = src;
    modal.style.display = "flex";
}
</script>
</body>
</html>
