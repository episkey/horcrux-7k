<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HORCRUX Command Center</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
    margin:0;
    font-family:'Orbitron',sans-serif;
    background:linear-gradient(135deg,#0a0a0a,#1a1a1a);
    color:white;
}
header{
    text-align:center;
    padding:40px 20px;
    position: relative;
}
.logo-container{
    position:relative;
    display:inline-block;
}
.logo-container img{
    width:150px;
    height:150px;
    border-radius:50%;
    border:none;
    box-shadow: 0 0 30px #ff0033, 0 0 50px rgba(255,0,0,0.5);
}
.logo-container .sub{
    color:#ff4444;
    margin-top:10px;
    font-size:18px;
}
header button{
    position:absolute;
    top:20px;
    right:20px;
    background:#ff0033;
    color:white;
    padding:10px 15px;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
header button:hover{ background:#ff5555; }

/* Dashboard */
.dashboard{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(180px, 1fr)); /* ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡∏¢‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà */
    gap:20px;
    padding:30px;
    justify-items:center;
    width: 90%; /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á grid */
    margin: 0 auto; /* ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏•‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ */
}
.card{
    background:#111;
    border:2px solid #ff0033;
    padding:25px 10px;
    text-align:center;
    border-radius:12px;
    transition:0.3s;
    cursor:pointer;
    width: 100%; /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏ï‡πá‡∏° column */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height:120px; /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô */
}
.card:hover{
    transform:scale(1.05);
    box-shadow:0 0 20px #ff0033;
}
.card h2{
    margin:10px 0 0 0;
    font-size:16px;
}
.card span{
    font-size:30px;
}

/* Dropdown */
#enemyDropdown{
    width:80%;
    max-width:400px;
    margin:20px auto;
    padding:10px;
    border-radius:6px;
    border:none;
    background:#111;
    color:white;
}

/* House Details */
.house-card{
    background:#111;
    border:2px solid #ff0033;
    border-radius:12px;
    padding:15px;
    margin:15px auto;
    max-width:600px;
    text-align:center;
}
.slider {
    display:flex;
    overflow-x:auto;
    gap:10px;
    scroll-behavior:smooth;
}
.slider img{
    height:120px;
    border-radius:6px;
    cursor:pointer;
}

/* Form ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π */
#add-form{
    background:#111;
    border:2px solid #ff0033;
    border-radius:12px;
    padding:20px;
    margin:20px auto;
    max-width:600px;
    text-align:center;
    display:none;
}
#add-form input, #add-form textarea, #add-form select{
    width:100%;
    margin-bottom:10px;
    padding:8px;
    border-radius:6px;
    border:none;
}
#add-form button{
    background:#ff0033;
    color:white;
    padding:10px 20px;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
#add-form button:hover{ background:#ff5555; }
.upload-btn{
    display:block;
    background:#ff0033;
    padding:10px;
    border-radius:8px;
    cursor:pointer;
    margin-bottom:10px;
    transition:0.3s;
    text-align:center;
}
.upload-btn:hover{ background:#ff4444; }

/* modal zoom */
#imgModal{
    display:none;
    position:fixed;
    inset:0;
    background:#000000cc;
    justify-content:center;
    align-items:center;
    z-index:999;
}
#imgModal img{
    max-width:90%;
    max-height:90%;
}

/* Footer */
footer{
    text-align:center;
    padding:20px;
    color:#555;
}
</style>
</head>
<body>

<header>
    <div class="logo-container">
        <img src="HORCRUX-LOGO.png" alt="HORCRUX Logo">
        <div class="sub">COMMAND CENTER</div>
    </div>
</header>

<section class="dashboard">
    <div class="card" onclick="filterCategory('castle')"><span>üè∞</span><h2>‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡∏ä‡∏¥‡∏á‡∏õ‡∏£‡∏≤‡∏™‡∏≤‡∏ó</h2></div>
    <div class="card" onclick="filterCategory('guild')"><span>‚öî</span><h2>‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡∏Å‡∏¥‡∏•‡∏î‡πå</h2></div>
    <div class="card" onclick="filterCategory('traveler')"><span>üåå</span><h2>‡∏ô‡∏±‡∏Å‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏∏‡∏ï‡∏¥</h2></div>
    <div class="card" onclick="filterCategory('strategy')"><span>üß†</span><h2>‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ï‡∏µ‡∏î‡πà‡∏≤‡∏ô / ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</h2></div>
</section>

<!-- Dropdown ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏®‡∏±‡∏ï‡∏£‡∏π -->
<select id="enemyDropdown" onchange="showEnemyDetails()">
    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏®‡∏±‡∏ï‡∏£‡∏π --</option>
</select>
<button onclick="toggleAddForm()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π</button>

<!-- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ö‡πâ‡∏≤‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π -->
<div id="houseDetails"></div>

<!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π -->
<section id="add-form">
    <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡∏®‡∏±‡∏ï‡∏£‡∏π</h3>
    <input type="text" id="enemy_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏®‡∏±‡∏ï‡∏£‡∏π" required>
    <label class="upload-btn">üì∑ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏ù‡∏±‡πà‡∏á‡∏®‡∏±‡∏ï‡∏£‡∏π<input type="file" id="enemy_file" multiple accept="image/*"></label>
    <div id="enemy_preview"></div>

    <label class="upload-btn">‚öî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡∏°‡∏ö‡∏∏‡∏Å<input type="file" id="team_file" multiple accept="image/*"></label>
    <div id="team_preview"></div>

    <textarea id="strategy" rows="3" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î / ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ö‡∏∏‡∏Å" required></textarea>
    <select id="category">
        <option value="castle">‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡∏ä‡∏¥‡∏á‡∏õ‡∏£‡∏≤‡∏™‡∏≤‡∏ó</option>
        <option value="guild">‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°‡∏Å‡∏¥‡∏•‡∏î‡πå</option>
        <option value="traveler">‡∏ô‡∏±‡∏Å‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏∏‡∏ï‡∏¥</option>
        <option value="strategy">‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ï‡∏µ‡∏î‡πà‡∏≤‡∏ô / ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
    </select>

    <button type="button" onclick="saveData()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ö‡πâ‡∏≤‡∏ô</button>
</section>

<!-- modal zoom -->
<div id="imgModal" onclick="closeModal()"><img id="modalImg"></div>

<footer>HORCRUX ‚Ä¢ Dominate The War</footer>

<script>
const supabaseClient = supabase.createClient(
  "https://cwkmfpxmzqlbrioununv.supabase.co",
  "sb_publishable_bmbm3cCoH3OoVvMfbQis8A_AgJgpCMX"
);

let allData = [];
let currentCategory = "";

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
async function loadData(){
    const { data, error } = await supabaseClient.from("enemy_base").select("*").order("created_at",{ascending:false});
    if(error){ console.error(error); return; }
    allData = data;
}

// ‡∏Å‡∏£‡∏≠‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà -> update dropdown ‡∏î‡πâ‡∏ß‡∏¢ enemy_name
function filterCategory(cat){
    currentCategory = cat;
    const filtered = allData.filter(row=>row.category===cat);
    const dropdown = document.getElementById("enemyDropdown");
    dropdown.innerHTML = `<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏®‡∏±‡∏ï‡∏£‡∏π --</option>`;
    filtered.forEach((row,i)=>{
        dropdown.innerHTML += `<option value="${i}">${row.enemy_name}</option>`;
    });
    document.getElementById("houseDetails").innerHTML = "";
}

// ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏®‡∏±‡∏ï‡∏£‡∏π
function showEnemyDetails(){
    const dropdown = document.getElementById("enemyDropdown");
    const idx = dropdown.value;
    if(idx === ""){ document.getElementById("houseDetails").innerHTML=""; return; }
    const row = allData.filter(r=>r.category===currentCategory)[idx];

    let enemySlider = `<div class="slider">${(row.enemy_imgs||[]).map(u=>`<img src="${u}" onclick="zoomImage('${u}')">`).join("")}</div>`;
    let teamSlider = `<div class="slider">${(row.team_imgs||[]).map(u=>`<img src="${u}" onclick="zoomImage('${u}')">`).join("")}</div>`;

    document.getElementById("houseDetails").innerHTML = `
        <div class="house-card">
            <b>‡∏ä‡∏∑‡πà‡∏≠‡∏®‡∏±‡∏ï‡∏£‡∏π:</b> ${row.enemy_name}<br><br>
            <b>‡∏ù‡∏±‡πà‡∏á‡∏®‡∏±‡∏ï‡∏£‡∏π:</b><br>${enemySlider}<br>
            <b>‡∏ó‡∏µ‡∏°‡∏ö‡∏∏‡∏Å:</b><br>${teamSlider}<br>
            <b>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</b><br>${row.strategy}
        </div>
    `;
}

// Toggle ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡πâ‡∏≤‡∏ô
function toggleAddForm(){
    const form = document.getElementById("add-form");
    form.style.display = (form.style.display==="none")?"block":"none";
}

// Modal Zoom
function zoomImage(src){
    const modal = document.getElementById("imgModal");
    modal.style.display="flex";
    document.getElementById("modalImg").src = src;
}
function closeModal(){ document.getElementById("imgModal").style.display="none"; }

// ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ
async function uploadMultipleImages(files){
    if(!files || files.length===0) return [];
    const urls = [];
    for(const file of files){
        const ext = file.name.split('.').pop();
        const name = `${Date.now()}_${Math.random().toString(36).substring(2)}.${ext}`;
        const path = `horcrux/${name}`;
        const { error } = await supabaseClient.storage.from('images').upload(path, file, {cacheControl:'3600', upsert:true});
        if(error){ console.error(error); continue; }
        const { data: urlData } = supabaseClient.storage.from('images').getPublicUrl(path);
        urls.push(urlData.publicUrl);
    }
    return urls;
}

// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ö‡πâ‡∏≤‡∏ô
async function saveData(){
    const enemyFiles = document.getElementById("enemy_file").files;
    const teamFiles = document.getElementById("team_file").files;
    const strategy = document.getElementById("strategy").value;
    const category = document.getElementById("category").value;
    const enemy_name = document.getElementById("enemy_name").value;
    if(!enemy_name || enemyFiles.length===0||teamFiles.length===0||!strategy){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á!"); return; }
    const enemyUrls = await uploadMultipleImages(enemyFiles);
    const teamUrls = await uploadMultipleImages(teamFiles);
    const { error } = await supabaseClient.from("enemy_base").insert([{
        enemy_name,
        enemy_imgs: enemyUrls,
        team_imgs: teamUrls,
        strategy,
        category
    }]);
    if(error){ alert(error.message); return; }
    alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
    document.getElementById("add-form").reset();
    loadData();
}

loadData();
</script>
</body>
</html>
